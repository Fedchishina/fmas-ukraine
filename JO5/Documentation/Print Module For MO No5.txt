
Автор:                                          Найденов Е.А.
Дата создания:                            20.11.2006
Дата последней модификации: 20.11.2006

----------------------------
ОБЩИЕ ПОЛОЖЕНИЯ :
----------------------------

Для использования модуля печати мемориальной отчетности журнала ЖО №5 необходимо иметь в наличии:

Файлы библиотек :

Основные:
*********
- JO5_PRT_MO.fr3;
- JO5_SetPrtMOParams7.bpl;
- JO5_SetPrtMOParams7.dcp (нужен только для компиляции);

Вспомогательные:
***************
Отсутствуют;

Объекты БД:

Таблицы:
********
- JO5_INI_SETUP     - хранит конфигурационную информацию;
- JO5_BUFFER_MO - временнная таблица для формирования мемориальной отчетности;

Хранимые процедуры:
*******************
- JO5_BUFFER_MO_DEL                    - очищает временную табл;
- JO5_BUFFER_MO_INS                     - заполняет  временную табл;
- JO5_GET_MO_PARAMS                   - получает множество параметров (тип средств + программа финансирования) для                                                                                           формирования МО;
- JO5_GET_DATA_FOR_PRT_MO     - формирует мемориальную отчетность за период;
- JO5_GET_DATA_MO_BY_PERIOD - формирует мемориальную отчетность за месяц;


---------------------------
ИНТЕРФЕЙС ВЫЗОВА
---------------------------

Для загрузки диалога выбора параметров печати мемориальной отчетности, необходимо вызвать экспортируемую процедуру SetPrtMOParamsExt.

Синтаксис вызова этой процедуры следующий:

procedure SetPrtMOParamsExt( aInputParams: TRec_InputParams ); stdcall;

Обязательными полями для корректной работы модуля, подлежащими заполнению являются:
	
  TRec_InputParams = record
      Owner              : TComponent;
      DBHandle        : TISC_DB_HANDLE;
      PeriodDateBeg : TDate;
      PeriodDateEnd : TDate;
  end;

Дополнительными (необязательными) параметрами для структуры TRec_InputParams являются:

  TRec_InputParams = record
      ReportPath : String;
  end;


-----------------------------------
ЛОГИКА РАБОТЫ МОДУЛЯ
-----------------------------------

Конечным пользователем может быть выбрано любое количество комбинаций параметров тип средств + программа финансирования. После того, как определено множество вышеописанных параметров, выполняется непосредственное формирование печатной формы. Оно выполняется последовательно, в четыре этапа в контексте двух различных транзакций: пишушей и читающей. Т.е.

1-й этап: 
               в контексте пишущей транзакции вызывается процедура JO5_BUFFER_MO_INS,
               заполняющая буфер промежуточными данными для формирования мемориальной отчетности.
2-й этап:
               в рамках читающей транзакции вызывается процедура JO5_GET_DATA_FOR_PRT_MO, которая на                                                            основании промежуточных данных из временной таблицы формирует результирующий набор данных для печати.
3-й этап:
               отображение печатной формы на основании полученных данных;
4-й этап: 
               в рамках пишущей транзакции вызывается процедура JO5_BUFFER_MO_DEL, очищающая временную таблицу от 
               промежуточных данных.
